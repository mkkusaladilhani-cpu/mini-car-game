<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cartoon Top-View Racing Shooter</title>
  <style>
    :root{--bg:#0b1020;--card:#0f141a;--accent:#4dd0e1;--text:#e9f0ff}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b1220,#07101a);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    .app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
    .layout{width:920px;max-width:calc(100% - 36px);display:grid;grid-template-columns:1fr 320px;gap:12px}
    .card{background:linear-gradient(180deg,#0f1620,#0b1016);border-radius:12px;padding:12px;color:var(--text);box-shadow:0 12px 40px rgba(0,0,0,.6)}
    canvas{width:100%;height:auto;border-radius:8px;background:#6aa8ff;display:block}
    .panel{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;gap:8px;align-items:center}
    .title{font-weight:700;font-size:16px}
    .small{font-size:13px;color:#c7d7ee}
    .btn{background:transparent;border:1px solid rgba(255,255,255,.06);padding:8px;border-radius:8px;color:var(--text);cursor:pointer}
    .iconGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .vehBtn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer;border:2px solid transparent}
    .vehBtn.active{border-color:rgba(77,208,225,.9)}
    .controlRow{display:flex;gap:8px;align-items:center}
    .hearts{display:flex;gap:6px}
    .loader{height:10px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden}
    .loader > div{height:100%;width:0%;background:linear-gradient(90deg,#ffd36b,#ff8aa1)}
    .rightTop{display:flex;justify-content:space-between;align-items:center}
    .rightPanel{height:100%;display:flex;flex-direction:column}
    .footer{font-size:12px;color:#9fb7d9;margin-top:8px;text-align:center}
    @media(max-width:980px){ .layout{grid-template-columns:1fr} .panel{order:2} }
  </style>
</head>
<body>
  <div class="app">
    <div class="layout">
      <div class="card">
        <div style="position:relative">
          <canvas id="game" width="560" height="740"></canvas>
          <div id="loadScreen" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:linear-gradient(180deg,rgba(3,6,20,.85),rgba(3,6,20,.9));border-radius:8px;color:var(--text)">
            <div style="font-size:20px;margin-bottom:10px">Loading ‚Äî Cartoon vehicles & sounds</div>
            <div class="loader" style="width:260px"><div id="loaderFill"></div></div>
            <div class="small" style="margin-top:10px">Please wait...</div>
          </div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div class="small">Score: <strong id="score">0</strong> ‚Äî High: <strong id="high">0</strong></div>
          <div class="hearts" id="hearts"></div>
        </div>

      </div>

      <div class="card panel">
        <div class="rightTop">
          <div class="title">Controls & Options</div>
          <div class="small">Horn: Q ‚Äî Shoot: Space</div>
        </div>

        <div>
          <div class="small" style="margin-bottom:6px">Vehicles (choose one)</div>
          <div class="iconGrid" id="vehicleGrid"></div>
        </div>

        <div>
          <div class="small" style="margin-bottom:6px">Vehicle color</div>
          <input id="colorPick" type="color" value="#3fe187" style="width:100%;height:40px;border-radius:8px;border:0;padding:4px" />
        </div>

        <div>
          <div class="small" style="margin-bottom:6px">Background</div>
          <div class="controlRow">
            <button class="btn" id="bgDay">Day ‚òÄÔ∏è</button>
            <button class="btn" id="bgAfternoon">Afternoon üå§Ô∏è</button>
            <button class="btn" id="bgNight">Night üåô</button>
          </div>
        </div>

        <div>
          <div class="small" style="margin-bottom:6px">Road type</div>
          <div class="controlRow">
            <button class="btn" id="oneWay">One way ‚û°Ô∏è</button>
            <button class="btn" id="twoWay">Two way ‚ÜîÔ∏è</button>
          </div>
        </div>

        <div>
          <div class="small" style="margin-bottom:6px">Screen</div>
          <div class="controlRow">
            <button class="btn" id="fullscreenBtn">Fullscreen ‚§¢</button>
            <button class="btn" id="restartBtn">Restart ‚Ü∫</button>
          </div>
        </div>

        <div style="margin-top:8px">
          <div class="small" style="margin-bottom:6px">Quick actions</div>
          <div class="controlRow">
            <button class="btn" id="playHorn">Horn üìØ</button>
            <button class="btn" id="soundToggle">Mute üîä</button>
          </div>
        </div>

        <div class="footer">Top-view cartoon racing shooter ‚Äî Save this HTML and open in browser</div>
      </div>
    </div>
  </div>

<script>
// Single-file Cartoon Top-View Racing Shooter (HTML+JS)
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d', { alpha: false });
  const W = canvas.width, H = canvas.height;
  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const heartsEl = document.getElementById('hearts');
  const loadScreen = document.getElementById('loadScreen');
  const loaderFill = document.getElementById('loaderFill');

  // vehicles (cartoon) metadata
  const VEHICLES = [
    {id:'car', label:'Car', emoji:'üöó'},
    {id:'lorry', label:'Lorry', emoji:'üöö'},
    {id:'van', label:'Van', emoji:'üöê'},
    {id:'bike', label:'Bicycle', emoji:'üö≤'},
    {id:'truck', label:'Truck', emoji:'üöõ'}
  ];

  // state
  let selected = 0;
  let vehColor = localStorage.getItem('veh_color') || '#3fe187';
  let bgMode = localStorage.getItem('bg_mode') || 'day';
  let roadMode = localStorage.getItem('road_mode') || 'one';
  let score = 0;
  let high = Number(localStorage.getItem('racing_high') || 0);
  highEl.textContent = high;

  let livesMax = 5, lives = livesMax;
  let running = false;
  let baseSpeed = 3;
  let obstacles = [];
  let bullets = [];
  let obstacleTimer = 0;
  let keyState = {left:false,right:false};

  // audio (simple oscillator-based funny sounds)
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let audio = null; // create on first interaction for mobile autoplay policy
  let soundsOn = true;
  function ensureAudio(){ if (!audio) audio = new AudioCtx(); }
  function funnyPing(){ if(!soundsOn) return; ensureAudio(); const o=audio.createOscillator(), g=audio.createGain(); o.type='triangle'; o.frequency.setValueAtTime(600+Math.random()*300,audio.currentTime); g.gain.setValueAtTime(0.03,audio.currentTime); o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime+0.12); }
  function horn(){ if(!soundsOn) return; ensureAudio(); const o=audio.createOscillator(), g=audio.createGain(); o.type='sawtooth'; o.frequency.setValueAtTime(220,audio.currentTime); g.gain.setValueAtTime(0.06,audio.currentTime); g.gain.exponentialRampToValueAtTime(0.001,audio.currentTime+0.4); o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime+0.45); }
  function crashSound(){ if(!soundsOn) return; ensureAudio(); const o=audio.createOscillator(), g=audio.createGain(); o.type='square'; o.frequency.setValueAtTime(120,audio.currentTime); g.gain.setValueAtTime(0.08,audio.currentTime); o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime+0.6); }
  function shootSound(){ if(!soundsOn) return; ensureAudio(); const o=audio.createOscillator(), g=audio.createGain(); o.type='sine'; o.frequency.setValueAtTime(1000,audio.currentTime); g.gain.setValueAtTime(0.03,audio.currentTime); o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime+0.14); }
  function victorySound(){ if(!soundsOn) return; ensureAudio(); [660,880,990].forEach((f,i)=>{ const o=audio.createOscillator(), g=audio.createGain(); o.type='sine'; o.frequency.setValueAtTime(f,audio.currentTime+i*0.06); g.gain.setValueAtTime(0.03,audio.currentTime+i*0.06); o.connect(g); g.connect(audio.destination); o.start(audio.currentTime+i*0.06); o.stop(audio.currentTime+i*0.06+0.25); }); }

  // UI: vehicle grid
  const vehicleGrid = document.getElementById('vehicleGrid');
  VEHICLES.forEach((v,i)=>{
    const el = document.createElement('div'); el.className='vehBtn'+(i===selected?' active':'');
    el.innerHTML = `<div style="font-size:28px">${v.emoji}</div><div style="font-size:12px">${v.label}</div>`;
    el.addEventListener('click', ()=>{ document.querySelectorAll('.vehBtn').forEach(n=>n.classList.remove('active')); el.classList.add('active'); selected=i; funnyPing(); });
    vehicleGrid.appendChild(el);
  });

  // color picker
  const colorPick = document.getElementById('colorPick');
  colorPick.value = vehColor;
  colorPick.addEventListener('input', ()=>{ vehColor = colorPick.value; localStorage.setItem('veh_color', vehColor); });

  // background buttons
  document.getElementById('bgDay').addEventListener('click', ()=>{ bgMode='day'; localStorage.setItem('bg_mode',bgMode); funnyPing(); });
  document.getElementById('bgAfternoon').addEventListener('click', ()=>{ bgMode='afternoon'; localStorage.setItem('bg_mode',bgMode); funnyPing(); });
  document.getElementById('bgNight').addEventListener('click', ()=>{ bgMode='night'; localStorage.setItem('bg_mode',bgMode); funnyPing(); });

  // road mode
  document.getElementById('oneWay').addEventListener('click', ()=>{ roadMode='one'; localStorage.setItem('road_mode',roadMode); funnyPing(); });
  document.getElementById('twoWay').addEventListener('click', ()=>{ roadMode='two'; localStorage.setItem('road_mode',roadMode); funnyPing(); });

  // fullscreen
  document.getElementById('fullscreenBtn').addEventListener('click', ()=>{ const el = document.documentElement; if(!document.fullscreenElement) el.requestFullscreen?.(); else document.exitFullscreen?.(); });

  // restart
  document.getElementById('restartBtn').addEventListener('click', ()=>{ resetGame(); });

  // horn & sound toggle
  document.getElementById('playHorn').addEventListener('click', ()=>{ horn(); });
  const soundToggle = document.getElementById('soundToggle');
  soundToggle.addEventListener('click', ()=>{ soundsOn = !soundsOn; soundToggle.textContent = soundsOn ? 'Mute üîä' : 'Unmute üîà'; });

  // loader simulation
  let loadP = 0; const loadInterval = setInterval(()=>{ loadP += 8 + Math.random()*8; if(loadP>100) loadP=100; loaderFill.style.width = loadP + '%'; if(loadP===100){ clearInterval(loadInterval); setTimeout(()=>{ loadScreen.style.display='none'; startGame(); }, 400); } }, 120);

  // road layout
  const road = { x: W*0.14, w: W*0.72, laneCount:3 };
  road.laneWidth = road.w / road.laneCount;
  const laneCenters = Array.from({length:road.laneCount}, (_,i)=> road.x + road.laneWidth*(i+0.5));

  // player vehicle
  const player = { lane:1, x:laneCenters[1], y: H-110, w:42, h:66, color:vehColor };

  // lines for motion
  const lines = []; for(let i=0;i<10;i++) lines.push({y:i*(H/10)});

  // spawn obstacles
  function spawnObstacle(){
    const lane = Math.floor(Math.random()*road.laneCount);
    const size = 32 + Math.random()*36;
    const colors = ['#ff6b6b','#ffd166','#9ad0f5','#a6e3a1'];
    obstacles.push({lane,x:laneCenters[lane],y:-size,w:size,h:size*0.6,color:colors[Math.floor(Math.random()*colors.length)], type: 'vehicle'});
  }

  // bullets (shoot upward)
  function shoot(){ bullets.push({x:player.x, y:player.y - player.h*0.5, r:6, vy:-8, t:0}); shootSound(); }

  // input handlers
  window.addEventListener('keydown', e=>{
    if(['ArrowLeft','a'].includes(e.key)) keyState.left=true;
    if(['ArrowRight','d'].includes(e.key)) keyState.right=true;
    if(e.code==='Space'){ e.preventDefault(); // shoot
      if(running) shoot(); else { resetGame(); }
    }
    if(e.key.toLowerCase()==='q') horn();
  });
  window.addEventListener('keyup', e=>{ if(['ArrowLeft','a'].includes(e.key)) keyState.left=false; if(['ArrowRight','d'].includes(e.key)) keyState.right=false; });

  // touch left/right (for mobile) - simple screen halves
  canvas.addEventListener('touchstart', (ev)=>{ ev.preventDefault(); ensureAudio(); const t = ev.touches[0]; if(t.clientX < window.innerWidth/2) keyState.left=true; else keyState.right=true; });
  canvas.addEventListener('touchend', (ev)=>{ keyState.left=false; keyState.right=false; });

  // hearts render
  function renderHearts(){ heartsEl.innerHTML=''; for(let i=0;i<livesMax;i++){ const s = document.createElement('div'); s.textContent = i<lives ? '‚ù§Ô∏è' : 'ü§ç'; heartsEl.appendChild(s);} }

  // reset & start
  function resetGame(){ score=0; scoreEl.textContent='0'; obstacles=[]; bullets=[]; obstacleTimer=0; baseSpeed=3; player.lane=1; player.x=laneCenters[1]; running=true; lives=livesMax; renderHearts(); }
  function startGame(){ resetGame(); loop(); }

  // collision helper
  function rectIntersect(a,b){ return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y; }

  // animations arrays
  const pops = [];

  // update loop
  function update(){ if(!running) return;
    // lane change discrete
    if(keyState.left && player.lane>0){ player.lane--; keyState.left=false; }
    if(keyState.right && player.lane < road.laneCount-1){ player.lane++; keyState.right=false; }
    player.x += (laneCenters[player.lane] - player.x) * 0.22;

    baseSpeed += 0.0015; obstacleTimer++;
    if(obstacleTimer > Math.max(30, 90 - Math.floor(score/150))){ spawnObstacle(); obstacleTimer=0; }

    for(let i=obstacles.length-1;i>=0;i--){ const o=obstacles[i]; o.y += baseSpeed; if(roadMode==='two') o.x += Math.sin(o.y/60)*0.5; if(o.y>H+80) obstacles.splice(i,1); }

    // bullets
    for(let i=bullets.length-1;i>=0;i--){ const b=bullets[i]; b.y += b.vy; b.t += 1; if(b.y < -20) bullets.splice(i,1); else{
        // check collision with obstacles
        for(let j=obstacles.length-1;j>=0;j--){ const ob=obstacles[j]; if(rectIntersect({x:b.x-b.r,y:b.y-b.r,w:b.r*2,h:b.r*2},{x:ob.x-ob.w/2,y:ob.y-ob.h/2,w:ob.w,h:ob.h})){ // hit
            // spawn pop animation and sound
            pops.push({x:ob.x,y:ob.y,t:0}); obstacles.splice(j,1); bullets.splice(i,1); funnyPing(); score += 40; scoreEl.textContent = score; break; }
        }
    }}

    // collision player with obstacles
    for(let i=obstacles.length-1;i>=0;i--){ const o=obstacles[i]; if(rectIntersect({x:player.x-player.w/2,y:player.y-player.h/2,w:player.w,h:player.h},{x:o.x-o.w/2,y:o.y-o.h/2,w:o.w,h:o.h})){ // crash
        obstacles.splice(i,1); pops.push({x:o.x,y:o.y,t:0}); lives--; renderHearts(); crashSound(); if(lives<=0){ running=false; if(score>high){ high=score; localStorage.setItem('racing_high',high); highEl.textContent = high; } setTimeout(()=>{ if(confirm('Game Over ‚Äî Restart?')) resetGame(); },100); } break; }
    }

    // update pops
    for(let i=pops.length-1;i>=0;i--){ pops[i].t += 0.06; if(pops[i].t>1.2) pops.splice(i,1); }

    // score increase
    score += Math.floor(baseSpeed/2.2);
    scoreEl.textContent = score;

    // victory check
    const VICTORY = 2000;
    if(score >= VICTORY){ running=false; victorySound(); setTimeout(()=>{ alert('Victory! You win üèÜ'); if(score>high){ high=score; localStorage.setItem('racing_high',high); highEl.textContent=high;} if(confirm('Play again?')) resetGame(); },120); }
  }

  // draw functions
  function roundRect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); ctx.fill(); }

  function drawVehicleShape(x,y,w,h, type){ // simple cartoon vehicle using shapes & emoji
    ctx.save(); ctx.translate(x,y);
    // body
    ctx.fillStyle = vehColor; roundRect(0,0,w,h,8);
    // window
    ctx.fillStyle = 'rgba(255,255,255,0.22)'; roundRect(w*0.14, h*0.12, w*0.72, h*0.34, 6);
    // wheels
    ctx.fillStyle = '#222'; const ww=Math.max(6,Math.floor(w*0.22)); ctx.fillRect(6,h-(ww+4),ww,ww); ctx.fillRect(w-(ww+10),h-(ww+4),ww,ww);
    // emoji mark
    ctx.font = '18px serif'; ctx.textAlign='center'; ctx.fillStyle = 'rgba(0,0,0,0.15)'; ctx.fillText(type.emoji, w/2, h/2 + 6);
    ctx.restore();
  }

  function draw(){
    // background
    if(bgMode==='day'){ ctx.fillStyle='#87ceeb'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#ffd24d'; ctx.beginPath(); ctx.arc(W-60,60,28,0,Math.PI*2); ctx.fill(); }
    else if(bgMode==='afternoon'){ ctx.fillStyle='#d0ecff'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#ffcf78'; ctx.beginPath(); ctx.arc(W-60,80,20,0,Math.PI*2); ctx.fill(); }
    else { ctx.fillStyle='#081229'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#f0f8ff'; ctx.beginPath(); ctx.arc(W-60,70,18,0,Math.PI*2); ctx.fill(); }

    // road
    ctx.fillStyle='#2c2c2c'; const rx=road.x, rw=road.w; roundRect(rx-8,0,rw+16,H,20);
    // side rails
    ctx.fillStyle='#111'; roundRect(rx-36,0,24,H,12); roundRect(rx+rw+12,0,24,H,12);
    // lane separators
    ctx.strokeStyle='#eaeaea'; ctx.lineWidth=3; for(let i=1;i<road.laneCount;i++){ const lx = rx + road.laneWidth*i; ctx.setLineDash([20,18]); ctx.beginPath(); ctx.moveTo(lx,0); ctx.lineTo(lx,H); ctx.stroke(); ctx.setLineDash([]); }

    // moving markers
    ctx.fillStyle='#f0f0f0'; for(let ln of lines){ for(let lane=0;lane<road.laneCount;lane++){ const cx = laneCenters[lane]; const size = 6 + Math.max(0, Math.floor((H - ln.y)/150)); ctx.fillRect(cx-4, ln.y + lane*8, 8, size); }}

    // obstacles
    for(let ob of obstacles){ ctx.fillStyle = ob.color; roundRect(ob.x - ob.w/2, ob.y - ob.h/2, ob.w, ob.h, 8); ctx.fillStyle='rgba(255,255,255,0.06)'; ctx.fillRect(ob.x - ob.w/4, ob.y - ob.h/4, ob.w/2, ob.h/3); }

    // bullets
    for(let b of bullets){ ctx.beginPath(); ctx.fillStyle='#fff'; ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill(); }

    // pops
    for(let p of pops){ ctx.save(); ctx.globalAlpha = Math.max(0,1 - p.t); ctx.fillStyle = 'rgba(255,200,80,0.9)'; ctx.beginPath(); ctx.arc(p.x, p.y, 8 + p.t*26, 0, Math.PI*2); ctx.fill(); ctx.restore(); }

    // player
    drawVehicleShape(player.x - player.w/2, player.y - player.h/2, player.w, player.h, VEHICLES[selected]);
  }

  // main loop
  function loop(){ update(); draw(); requestAnimationFrame(loop); }

  // pause when hidden
  document.addEventListener('visibilitychange', ()=>{ if(document.hidden) running=false; else running=true; });

  // initialize hearts UI
  function init(){ renderHearts(); }
  init();

})();
</script>
</body>
</html>
